<?xml version="1.0" encoding="UTF-8"?>
<BehaviorTree xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../MetaData/schema_ai.xsd" m_ContextType="ai">
    <Selector>
        <!-- Range - power attack -->
        <Optional m_Enabled="$power_attack_enabled">
            <Sequence>
                <CooldownUntil m_TimePoint="#power_attack_cooldown" m_CooldownTime="$attack_power_rest_time">
                    <SequenceMem>
                        <Optional m_Enabled="$needs_cautious_for_power_attack">
                            <Cnd_IsBBValueEqual_bool m_Key="#cautious_triggered" m_Value="true"/>
                        </Optional>
                        <Cnd_IsBBValueEqual_string m_Key="#tactic" m_Value="rush" m_Invert="true"/>
                        <Cnd_IsCombatTargetInRadius m_Radius="$attack_power_attempt_range_max"/>
                        <Cnd_IsCombatTargetInRadius m_Radius="$attack_power_attempt_range_min" m_Invert="true"/>
                        <Cnd_IsCombatTargetInSyncAction m_Invert="true"/>
                        <Cnd_InTargetHorzAngle m_Target="#target" m_Angle="40"/>
                        <Opr_GetDistanceToPosition m_Position="#target_pos" m_Distance="#slot_cost"/>
                        <CombatSlot m_Name="attack_power" m_Limit="$combat_slot_range_limit" m_MinDelay="$combat_slot_range_min_delay" m_Cost="#slot_cost">
                            <SequenceMem>
                                <Opr_SetBBValue_float m_Key="#input_attack_approach_range" m_Value="$attack_power_max_range"/>
                                <Opr_SetBBValue_float m_Key="#input_attack_approach_angle" m_Value="$attack_power_max_angle"/>
                                <Opr_SetBBValue_float m_Key="#input_attack_approach_cancel_range" m_Value="$attack_power_cancel_range"/>
                                <CompoundTree>
                                    <Selector>
                                        <ExternalTree m_UID="VIRAL_ATTACK_POWER" m_CustomName="Power" m_Hide="true"/>
                                        <ExternalTree m_UID="VIRAL_ATTACK_APPROACH" m_CustomName="Move" m_Hide="true"/>
                                    </Selector>
                                </CompoundTree>
                            </SequenceMem>
                        </CombatSlot>
                    </SequenceMem>
                </CooldownUntil>
            </Sequence>
        </Optional>
        <!-- Melee - quick combo attack -->
        <Sequence>
            <Cnd_IsBBValueEqual_string m_Key="#role" m_Value="melee"/>
            <Cnd_IsBBValueEqual_string m_Key="#tactic" m_Value="rush" m_Invert="true"/>
            <Cnd_IsBBValueEqual_string m_Key="#tactic" m_Value="cautious" m_Invert="true"/>
            <Cnd_IsCombatTargetInSyncAction m_SyncAction="BiterGrab" m_Invert="true"/>
            <CooldownUntil m_TimePoint="#attack_cooldown" m_CooldownTime="$attack_combo_rest_time">
                <SequenceMem>
                    <Cnd_IsCombatTargetInRadius m_Radius="$attack_quick_attempt_range"/>
                    <SequenceMem>
                        <Opr_SetBBValue_float m_Key="#input_attack_approach_range" m_Value="$attack_quick_max_range"/>
                        <Opr_SetBBValue_float m_Key="#input_attack_approach_angle" m_Value="$attack_quick_max_angle"/>
                        <Opr_SetBBValue_float m_Key="#input_attack_approach_cancel_range" m_Value="$attack_quick_cancel_range"/>
                        <Opr_SetBBValue_float m_Key="#input_attack_approach_movement_speed" m_Value="$quick_attack_approach_anim_speed"/>
                        <CompoundTree>
                            <Selector>
                                <ExternalTree m_UID="VIRAL_ATTACK_COMBO" m_CustomName="Combo" m_Hide="true"/>
                                <ExternalTree m_UID="VIRAL_ATTACK_APPROACH" m_CustomName="Move" m_Hide="true"/>
                            </Selector>
                        </CompoundTree>
                    </SequenceMem>
                </SequenceMem>
            </CooldownUntil>
        </Sequence>
        <!-- Melee - chase attack -->
        <Sequence>
            <Cnd_IsBBValueEqual_string m_Key="#tactic" m_Value="rush"/>
            <Cnd_IsCombatTargetInSyncAction m_SyncAction="BiterGrab" m_Invert="true"/>
            <CooldownTimeDelta m_CooldownTime="0.5">
                <SequenceMem>
                    <Cnd_IsCombatTargetInRadius m_Radius="20"/>
                    <SequenceMem>
                        <Opr_SetBBValue_float m_Key="#input_attack_approach_range" m_Value="2"/>
                        <Opr_SetBBValue_float m_Key="#input_attack_approach_angle" m_Value="90"/>
                        <Opr_SetBBValue_float m_Key="#input_attack_approach_cancel_range" m_Value="15"/>
                        <Opr_SetBBValue_float m_Key="#input_attack_approach_movement_speed" m_Value="2.2"/>
                        <CompoundTree>
                            <Selector>
                                <ExternalTree m_UID="VIRAL_ATTACK_CHASE" m_CustomName="Chase_Attack" m_Hide="true"/>
                                <ExternalTree m_UID="VIRAL_ATTACK_APPROACH" m_CustomName="Move" m_Hide="true"/>
                            </Selector>
                        </CompoundTree>
                    </SequenceMem>
                </SequenceMem>
            </CooldownTimeDelta>
        </Sequence>
    </Selector>
</BehaviorTree>
