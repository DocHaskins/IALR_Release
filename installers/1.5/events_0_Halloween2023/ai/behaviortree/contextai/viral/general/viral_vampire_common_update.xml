<?xml version="1.0" encoding="UTF-8"?>
<BehaviorTree xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../MetaData/schema_ai.xsd" m_ContextType="ai">
    <Parallel m_PolicySuccess="REQUIRE_ALL_DONE" m_PolicyFailure="REQUIRE_ALL_DONE">
        <ExternalTree m_UID="VIRAL_CHASE_UPDATE" m_CustomName="Chase" m_Hide="true"/>
        <ExternalTree m_UID="VIRAL_VAMPIRE_UPDATE_TACTICS" m_CustomName="Tactics" m_Hide="true"/>
        <Opr_GetUVEffectProgress m_Progress="#uv_progress"/>
        <Sequence>
            <Cnd_IsInUVLight/>
            <Opr_GetCurrentTime m_TimePoint="#last_time_in_uv_light"/>
            <Opr_GetClosestUVLightData m_Position="#uv_light_pos" m_Direction="#uv_light_dir" m_Type="#uv_light_type"/>
        </Sequence>
        <Sequence>
            <Cnd_HasBBValue m_Key="#forced_pos_set" m_Invert="true"/>
            <Opr_GetForcedChasePosition m_Position="#forced_chase_position"/>
            <Opr_SetBBValue_bool m_Key="#forced_pos_set" m_Value="true"/>
        </Sequence>
        <Selector>
            <Sequence>
                <Cnd_IsBBValueEqual_string m_Key="#tactic" m_Value="rush"/>
                <Cnd_SpaceInSimpleDirection m_Direction="FORWARD" m_MinRequiredSpace="2.5"/>
                <Opr_SetBBValue_string m_Key="#run_move_style" m_Value="Run_Fast"/>
            </Sequence>
            <Opr_SetBBValue_string m_Key="#run_move_style" m_Value="Run"/>
        </Selector>
        <CooldownTimeDelta m_CooldownTime="5.0" m_StatusReturned="SUCCESS">
            <Selector>
                <Cnd_IsAlertLevelEqual m_AlertLevel="High" m_Invert="true"/>
                <Cnd_IsActivityModuleRunning_SyncAction/>
                <Sequence>
                    <Opr_GetSelfPosition m_Position="#my_pos"/>
                    <Opr_MakeNoise m_NoiseUid="vampire_groan" m_Position="#my_pos"/>
                </Sequence>
            </Selector>
        </CooldownTimeDelta>
        <Sequence>
            <Cnd_DamageTaken/>
            <Opr_SetBBValue_bool m_Key="#is_awake" m_Value="true"/>
        </Sequence>
        <Selector>
            <Sequence>
                <Cnd_HasBBValue m_Key="#last_target"/>
                <Opr_EnableSense m_Sense="trail"/>
                <Opr_EnableTrailForTarget m_Target="#last_target"/>
            </Sequence>
            <Sequence>
                <Cnd_HasBBValue m_Key="#chase_target"/>
                <Opr_EnableSense m_Sense="trail"/>
                <Opr_EnableTrailForTarget m_Target="#chase_target"/>
            </Sequence>
            <Opr_DisableSense m_Sense="trail"/>
        </Selector>
        <Sequence>
            <Cnd_HasBBValue m_Key="#forced_chase_position"/>
            <Selector>
                <Cnd_HasBBValue m_Key="#target"/>
                <Sequence>
                    <Cnd_HasBBValue m_Key="#group_target"/>
                    <Cnd_IsPlayer m_Target="#group_target"/>
                </Sequence>
                <Cnd_PositionInRadius m_Radius="6" m_Position="#forced_chase_position"/>
            </Selector>
            <Opr_RemoveBBValue m_Key="#forced_chase_position"/>
        </Sequence>
    </Parallel>
</BehaviorTree>
